name: Direct SSH (GitHub Debug â€” solid)

on:
  workflow_dispatch:

jobs:
  ssh:
    runs-on: ubuntu-latest
    timeout-minutes: 360  # 6 hours

    steps:
    - name: Install tmate
      run: |
        sudo apt-get update
        sudo apt-get install -y tmate

    - name: Start interactive tmate session & print URLs
      shell: bash
      run: |
        set -euxo pipefail

        # Use a dedicated socket so we can manage the session reliably
        SOCK=/tmp/tmate.sock

        # Start a new detached session running a login shell
        tmate -S "$SOCK" new-session -d -s actions "bash -l"

        # Mark session as ready (tmate sets this when connection strings are available)
        tmate -S "$SOCK" wait tmate-ready

        # Grab connection strings
        RW_SSH=$(tmate -S "$SOCK" display -p '#{tmate_ssh}')
        RO_SSH=$(tmate -S "$SOCK" display -p '#{tmate_ssh_ro}')
        WEB_URL=$(tmate -S "$SOCK" display -p '#{tmate_web}')

        echo "============================================="
        echo "ðŸ’» SSH (read/write): $RW_SSH"
        echo "ðŸ‘€ SSH (read-only) : $RO_SSH"
        echo "ðŸŒ Web (browser)   : $WEB_URL"
        echo "============================================="

        {
          echo "## âœ… Direct SSH (tmate)"
          echo "**Read/Write SSH:** \`$RW_SSH\`"
          echo "**Read-Only SSH:** \`$RO_SSH\`"
          echo "**Web URL:** $WEB_URL"
          echo ""
          echo "_Tip: Use the **read/write** SSH link if you want to type._"
        } >> "$GITHUB_STEP_SUMMARY"

        # Keep the runner alive for 6 hours
        sleep 21600
